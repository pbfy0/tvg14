// Generated by CoffeeScript 1.7.1
var buf, loadLevel, textureForColor, textures;

buf = new Uint8Array([0x42, 0x4d, 0x3a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x36, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x13, 0x0b, 0x00, 0x00, 0x13, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00]);

textures = {};

textureForColor = function(color) {
  var b64string, x, _ref;
  if (textures[color] == null) {
    [].splice.apply(buf, [54, 3].concat(_ref = [color & 0xff, (color && 0xff00) >> 16, (color && 0xff0000) >> 32])), _ref;
    b64string = btoa(((function() {
      var _i, _len, _results;
      _results = [];
      for (_i = 0, _len = buf.length; _i < _len; _i++) {
        x = buf[_i];
        _results.push(String.fromCharCode(x));
      }
      return _results;
    })()).join(''));
    textures[color] = PIXI.Texture.fromImage('data:image/bmp;base64,' + b64string);
  }
  return textures[color];
};

loadLevel = function(stage, filename) {
  var xhr;
  xhr = new XMLHttpRequest();
  xhr.open('GET', filename, true);
  xhr.addEventListener('load', function(event) {
    var blocks, el, json, sprite, texture, _i, _len, _results;
    json = JSON.parse(xhr.responseText);
    blocks = json.blocks;
    _results = [];
    for (_i = 0, _len = blocks.length; _i < _len; _i++) {
      el = blocks[_i];
      texture = textureForColor(parseInt(el[4].substring(1), 16));
      sprite = new PIXI.Sprite(texture);
      sprite.position.x = el[0], sprite.position.y = el[1], sprite.width = el[2], sprite.height = el[3];
      _results.push(stage.addChild(sprite));
    }
    return _results;
  });
  return xhr.send();
};

document.addEventListener('DOMContentLoaded', function() {
  var animate, renderer, texture;
  window.stage = new PIXI.Stage(0x222222);
  renderer = PIXI.autoDetectRenderer(512, 512);
  document.body.appendChild(renderer.view);
  texture = textureForColor(0x0000ff);
  window.sprite = new PIXI.Sprite(texture);
  sprite.width = sprite.height = 100;
  sprite.position.x = sprite.position.y = 200;
  stage.addChild(sprite);
  animate = function() {
    requestAnimFrame(animate);
    return renderer.render(stage);
  };
  return requestAnimFrame(animate);
});
